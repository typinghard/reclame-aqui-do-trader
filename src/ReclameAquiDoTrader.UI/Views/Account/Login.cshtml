@model ReclameAquiDoTrader.UI.ViewModels.AcessoViewModel.SignInViewModel
@{
    ViewData["Title"] = "Login";
    Layout = "";
}

<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>@ViewData["Title"] | Entrar</title>

    <!-- Ladda style -->
    <link href="~/lib/ladda/css/ladda-themeless.min.css" rel="stylesheet">

    <link href="~/css/site.min.css" rel="stylesheet">

</head>

<body class="gray-bg">

    <div class="row">
        <div class="loginColumns animated fadeInDown">
            <div class="col-lg-12 shadow p-3 mb-5 bg-white rounded">
                <div class="ibox border-bottom">
                    <div class="ibox-content" style="display: flex;">
                        <div class="white-bg col-md-6 m-t / m-t-(xs,sm,md,lg,xl) border-right">
                            <h2 class="font-bold text-center">Reclame Aqui do Trader!</h2>
                            <hr class="hr-line-dashed">
                            <p class="text-justify">
                                Este login destina-se aos adiministradores do site, faça o login para ter acesso aos paineis administrativos.
                            </p>

                            <p class="text-justify font-weight-normal">
                                Caso tenha perdido a senha, para mais informações entre em contato no <email email-domain="reclameaquidotraderz.com">contato</email>.
                            </p>

                        </div>
                        <div class="col-md-6 m-t / m-t-(xs,sm,md,lg,xl)">
                            <div>
                                <h2 class="font-bold text-center">Login</h2>
                                <form class="m-t" id="form-login" role="form" asp-action="Login" method="post">

                                    <vc:Summary></vc:Summary>

                                    <div class="form-group">
                                        <div class="input-group m-b">
                                            <div class="input-group-prepend">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-user"></i>
                                                </span>
                                            </div>
                                            <input type="email" asp-for="Email" placeholder="E-mail" class="form-control" required>
                                        </div>
                                        <span class="text-danger msg-validacao" name="Email"></span>
                                    </div>

                                    <div class="form-group">
                                        <div class="input-group m-b">
                                            <div class="input-group-prepend">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-lock"></i>
                                                </span>
                                            </div>
                                            <input type="password" asp-for="Password" placeholder="Senha" class="form-control" required>
                                        </div>
                                        <span class="text-danger msg-validacao" name="Password"></span>
                                    </div>

                                    <button type="submit" class="ladda-button ladda-button-demo btn btn-primary block full-width m-b" data-style="zoom-out">Entrar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <hr />
                <div class="row">
                    <div class="col-md-6">
                        Reclame Aqui do Trader - Todos os Direitos Reservados
                    </div>
                    <div class="col-md-6 text-right">
                        <small>© 2018-@DateTime.UtcNow.Year</small>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="~/js/login.min.js"></script>

    <!-- Ladda -->
    <script src="~/lib/ladda/js/spin.min.js"></script>
    <script src="~/lib/ladda/js/ladda.min.js"></script>
    <script src="~/lib/ladda/js/ladda.jquery.min.js"></script>

</body>

</html>

<script>
    $('#form-login').submit(function () {

        var l = $('.ladda-button-demo').ladda();
        l.ladda('start');

        $.ajax({
            url: this.action,
            type: 'POST',
            processData: false,
            contentType: false,
            data: new FormData(this),
            success: function (result) {
                window.location.href = result.url;
            },
            error: function (result) {
                TratarErro(result);
            },
            complete: function () {
                $('.ladda-button-demo').ladda('stop');
            }
        });
        return false;
    });


    function TratarErro(resultError) {
        $('.msg-validacao').html('');
        $("input.error").removeClass('error');

        if (resultError.responseJSON == undefined) {
            //TO DO
        }

        let erros = resultError.responseJSON.erros;
        $(erros).each(function (i, erro) {
            $('[name="' + erro.chave + '"].msg-validacao').append(erro.mensagem + '</br>');
            $('input[name="' + erro.chave + '"]').addClass('error');
        });
    }

</script>